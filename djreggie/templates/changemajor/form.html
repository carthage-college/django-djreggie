{% extends "djkorra/base.html" %}
{% block title %}
    Change Major/Minor
{% endblock %}
{% block content_head %}
    <h1 id="page-title">Change Major/Minor</h1>
{% endblock %}
{% block extra_style %}
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css">
<style type="text/css">
    .tabme{
        color: grey;
        padding-left:2em
    }
    .ui-autocomplete.ui-menu {
        z-index: 10000;
      }
</style>
{% endblock %}
{% block extra_javascript %}
<script src="//code.jquery.com/ui/1.11.0/jquery-ui.js"></script>
<script>
    var list = new Array();
    {% for advisor in advisor_list %}
        list.push({label: "{{advisor.lastname}}, {{advisor.firstname}}",
                    value: "{{advisor.lastname}}, {{advisor.firstname}}"})
    {% endfor %}
    $('#id_advisor').autocomplete({source: list});
    $('#id_advisor').autocomplete('enable');
    
    $("select").change(function(){
        if ($(this).val() != ''){
            for (var i=0; i<$("select").length; i++){
                if ($("select")[i].id != $(this).attr("id")){
                    if ($(this).find(":selected").prop("text") == $("select :selected")[i].text){
                        $(this).val('');
                        alert("You have already selected that as a major or minor. You cannot select it again.");
                        break;
                    }
                }
            }
        }
    });
    
    $('.form').submit(function(){
        //if majors aren't ordered right ie. major2 have a value and major1 doesn't, then reoreder the data
        if ($("#id_major1").val() == '')
        {
            if ($("#id_major2").val() != '')
            {
                $("#id_major1").val($("#id_major2").val());
                $("#id_major2").val("");
            }
            else if ($("#id_major3").val() != '')
            {
                $("#id_major1").val($("#id_major3").val());
                $("#id_major3").val("");
            }
        }
        if ($("#id_major2").val() == '')
        {
            if ($("#id_major3").val() != '')
            {
                $("#id_major2").val($("#id_major3").val());
                $("#id_major3").val("");
            }
        }
        //do the same thing for minors
        if ($("#id_minor1").val() == '')
        {
            if ($("#id_minor2").val() != '')
            {
                $("#id_minor1").val($("#id_minor2").val());
                $("#id_minor2").val("");
            }
            else if ($("#id_minor3").val() != '')
            {
                $("#id_minor1").val($("#id_minor3").val());
                $("#id_minor3").val("");
            }
        }
        if ($("#id_minor2").val() == '')
        {
            if ($("#id_minor3").val() != '')
            {
                $("#id_minor2").val($("#id_minor3").val());
                $("#id_minor3").val("");
            }
        }
    });
</script>
{% endblock %}
{% block content %}
{{ form.non_field_errors }}
{% if submitted %}
<h3>Your form has been submitted</h3>
{% endif %}
<form action='' method='post' class = "form">{% csrf_token %}
    {{ mmformset.management_form }}
    {% for field in form.hidden_fields %}
        {{ field }}
        {{ field.errors }}
    {% endfor %}
    <fieldset class="blockLabels">
        <legend>Your Current Information</legend>
        <ol>
            <li class="ctrlHolder"><h3><label for="id_name">Name</label></h3>
                <div class=tabme>{{form.name.value}}<br></div>
            </li>
            <li class="ctrlHolder"><h3><label for="id_student_id">Student ID</label></h3>
                <div class=tabme>{{form.student_id.value}}<br></div>
            </li>
            <li class="ctrlHolder"><h3><label for="id_majorlist">Current Majors</label></h3>
                <div class=tabme>{{form.majorlist.value}}<br></div>
            </li>
            <li class="ctrlHolder"><h3><label for="id_minorlist">Current Minors</label></h3>
                <div class=tabme>{{form.minorlist.value}}<br></div>
            </li>
        </ol>
    </fieldset>
    <fieldset class="blockLabels">
        <legend>Majors and Minors</legend>
        <ol>
            <li class="ctrlHolder" id="major1"><h3><label for="id_major1">Majors</label></h3>
                <div class="required">
                    {{ form.major1 }}
                    {{ form.major1.errors }}
                </div>
            </li>
            <li class="ctrlHolder" id="major2"><h3><label for="id_major2"></label></h3>
                {{ form.major2 }}
            </li>
            <li class="ctrlHolder" id="major3"><h3><label for="id_major3"></label></h3>
                {{ form.major3 }}
            </li>
            <hr>
            <li class="ctrlHolder" id="minor1"><h3><label for="id_minor1">Minors</label></h3>
                {{ form.minor1 }}
            </li>                
            <li class="ctrlHolder" id="minor2"><h3><label for="id_minor2"></label></h3>
                {{ form.minor2 }}
            </li>                
            <li class="ctrlHolder" id="minor3"><h3><label for="id_minor3"></label></h3>
                {{ form.minor3 }}
            </li>
        </ol>
    </fieldset>
    <fieldset class="blockLabels">
        <legend>Advisor</legend>
        <ol>
            <li class="ctrlHolder"><h3><label for="id_advisor">
            Who would you like to be your new advisor? (If no change, leave blank)</label></h3>
                {{form.advisor}}
                {{form.advisor.errors}}
            </li>
            <li class="btnHolder">
                <label for="submit">&nbsp;&nbsp;</label>
                <input type="Submit" name="submit" value="Submit" class="button"/>
            </li>
        </ol>
    </fieldset>
</form>
{% endblock %}